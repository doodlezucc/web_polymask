import 'package:web_polymask/math/polygon.dart';
import 'package:web_polymask/math/polygon_state.dart';
import 'package:web_polymask/math/polymath.dart';

import 'test_helpers.dart';

void main() {
  final state = parseState('''
- (positive, 397,464 414,451 434,447 464,445 479,443 483,442 488,441 502,436 506,435 482,439 462,443 445,445 423,449 383,454 364,456 346,458 327,461 309,462 227,462 212,460 193,451 179,436 172,416 174,396 185,378 202,365 222,361 237,363 299,363 317,362 336,359 354,357 373,355 413,350 435,346 452,344 472,340 525,330 559,323 586,316 611,310 669,294 698,283 722,274 762,256 835,217 853,207 812,207 781,209 763,211 748,213 732,215 718,218 699,220 680,224 650,230 632,233 614,238 598,241 582,245 564,248 550,251 535,256 518,259 490,265 475,267 459,271 442,274 426,277 410,281 395,283 379,285 365,288 350,290 334,291 318,294 300,296 282,299 266,301 249,303 217,307 203,310 188,312 132,324 117,326 103,329 83,329 64,320 50,305 48,301 44,303 40,303 40,191 42,190 56,182 79,171 97,163 135,147 172,134 213,121 273,101 291,96 308,91 322,87 339,83 372,72 396,66 403,65 419,60 433,57 442,55 453,53 468,49 477,47 488,45 504,42 506,42 514,40 610,40 619,47 630,65 632,85 625,105 611,120 592,129 573,129 562,132 546,135 529,138 514,141 498,144 483,148 463,152 449,155 433,160 418,163 402,167 369,178 352,182 338,186 321,191 306,195 308,195 324,192 340,191 353,189 360,188 369,186 385,184 391,183 396,182 405,180 416,178 432,175 435,174 445,172 456,170 465,168 476,166 488,164 497,162 508,160 520,156 534,153 545,151 554,149 560,148 568,146 587,142 602,138 613,136 622,134 640,131 642,131 650,129 669,125 689,121 705,119 711,118 722,116 738,114 753,112 771,110 802,108 893,108 927,110 942,110 959,111 960,111 960,260 925,280 906,291 829,333 838,348 841,362 843,382 843,397 836,417 835,418 843,432 845,452 838,472 824,487 805,496 792,502 785,505 783,506 764,515 754,520 742,527 727,535 725,536 736,544 747,562 749,582 742,602 728,617 716,627 697,636 682,641 667,644 651,646 633,647 616,650 599,652 583,655 566,659 560,660 40,660 40,610 54,599 55,599 49,582 51,562 62,544 73,535 90,522 103,514 117,507 130,500 147,493 162,488 178,484 192,481 212,477 228,474 243,472 259,469 275,468 292,467 307,466 323,465 354,465 374,469 387,475 389,477)
''');

  final polygon = Polygon(
    points: parse(
        '434,447 424,546 409,546 390,537 376,522 369,502 371,482 382,464 399,451 419,447'),
  );

  final pstate = PolygonState.assignParents(state);
  print(pstate.isValid(checkSimplicity: true));
  final merger = PolygonMerger(
    onAdd: (p, parent) {
      print('add $p to $parent');
      if (!p.isSimple()) {
        print('POLYGON IS NOT SIMPLE');
      }
    },
    onRemove: (p) => print('remove $p'),
    onUpdateParent: (p, parent) => print('reappend $p to $parent'),
  );
  merger.mergePolygon(pstate, polygon);
  print(pstate);
  print(pstate.isValid());
}
