import 'package:web_polymask/math/polygon.dart';
import 'package:web_polymask/math/polygon_state.dart';
import 'package:web_polymask/math/polymath.dart';

import 'test_helpers.dart';

void main() {
  final state = parseState('''
- (positive, 560,260 560,180 600,180 600,200 640,200 640,180 680,180 680,160 700,160 700,140 740,140 740,100 720,100 720,80 800,80 800,60 840,60 840,40 880,40 880,80 860,80 860,100 840,100 840,120 880,120 880,140 900,140 900,160 920,160 920,180 940,180 940,220 960,220 960,380 940,380 940,400 960,400 960,560 860,560 860,540 900,540 900,520 920,520 920,480 780,480 780,460 800,460 800,440 820,440 820,420 840,420 840,380 860,380 860,360 900,360 900,280 860,280 860,260 900,260 900,240 920,240 920,200 840,200 840,180 800,180 800,160 760,160 760,140 740,140 740,160 760,160 760,200 740,200 740,180 720,180 720,200 680,200 680,220 620,220 620,240 580,240 580,260)
- (positive, 440,200 460,200 460,220 440,220)
- (positive, 340,280 340,300 380,300 380,280 440,280 440,300 380,300 380,320 300,320 300,340 280,340 280,300 300,300 300,280)
- (positive, 40,340 40,240 60,240 60,180 80,180 80,140 100,140 100,100 120,100 120,80 160,80 160,60 200,60 200,40 520,40 520,60 660,60 660,80 680,80 680,100 520,100 520,80 420,80 420,60 340,60 340,80 220,80 220,100 160,100 160,120 140,120 140,140 120,140 120,180 100,180 100,240 80,240 80,300 60,300 60,340)
- (positive, 180,380 180,400 140,400 140,340 160,340 160,300 180,300 180,260 220,260 220,380)
- (positive, 320,580 320,620 380,620 380,580 440,580 440,560 520,560 520,540 540,540 540,560 520,560 520,580 500,580 500,600 420,600 420,620 160,620 160,580 140,580 140,560 120,560 120,540 100,540 100,520 80,520 80,500 60,500 60,480 40,480 40,440 60,440 60,460 100,460 100,480 120,480 120,500 140,500 140,540 160,540 160,560 180,560 180,580)
''');

  final polygon = Polygon(
    points: parse(
        '300,600 300,620 320,620 320,640 360,640 360,580 320,580 320,600'),
    positive: false,
  );

  final pstate = PolygonState.assignParents(state);
  print(pstate.isValid(checkSimplicity: true));
  final merger = PolygonMerger(
    onAdd: (p, parent) {
      print('add $p to $parent');
      if (!p.isSimple()) {
        print('POLYGON IS NOT SIMPLE');
      }
    },
    onRemove: (p) => print('remove $p'),
    onUpdateParent: (p, parent) => print('reappend $p to $parent'),
  );
  merger.mergePolygon(pstate, polygon);
  print(pstate);
  print(pstate.isValid());
}
