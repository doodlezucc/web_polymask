import 'package:web_polymask/math/polygon.dart';
import 'package:web_polymask/math/polygon_state.dart';
import 'package:web_polymask/math/polymath.dart';

import 'test_helpers.dart';

void main() {
  final state = parseState('''
- (positive, 960,40 960,660 40,660 40,40)
  - (negative, 140,547 146,537 121,537 130,522 120,522 128,508 117,508 126,493 115,493 124,478 113,478 122,462 111,462 120,446 109,446 118,431 107,431 116,415 106,415 115,400 105,400 114,385 104,385 113,370 103,370 112,355 103,355 112,340 103,340 112,325 103,325 112,310 103,310 112,295 105,295 114,280 106,280 114,266 109,266 118,251 112,251 121,236 114,236 122,222 117,222 125,208 120,208 128,194 124,194 131,181 174,106 175,108 183,95 187,103 196,88 202,98 210,83 216,93 224,79 230,90 238,76 245,89 254,74 261,86 269,72 277,85 284,72 292,85 299,72 307,85 314,72 322,85 329,72 337,86 345,72 353,85 360,72 368,86 375,73 383,87 390,74 398,88 405,75 413,89 420,76 428,90 435,77 443,90 450,77 458,91 466,77 474,91 481,78 489,92 497,78 505,92 512,79 520,93 527,80 535,93 542,80 550,93 557,80 565,94 573,80 581,93 588,80 596,93 603,80 611,93 618,80 626,93 633,80 641,93 648,80 656,94 663,81 671,95 678,82 686,95 693,82 701,96 708,83 716,96 723,83 731,97 738,85 746,99 753,86 761,100 768,88 776,102 783,89 791,103 797,92 805,106 809,100 852,175 847,175 855,189 847,189 856,204 847,204 856,219 847,219 856,234 847,234 856,249 847,249 856,264 847,264 856,279 847,279 856,294 845,294 853,308 842,308 851,323 839,323 849,341 817,341 843,386 827,386 841,411 827,411 841,435 828,435 839,454 824,454 837,477 824,477 833,493 819,493 829,510 816,510 825,525 812,525 820,539 806,539 813,552 798,552 805,564 788,564 794,574 777,574 781,581 764,581 767,586 748,586 750,590 724,590 726,593 701,593 702,595 681,595 683,598 662,598 663,599 643,599 644,600 605,600 606,601 355,601 356,600 337,600 338,598 322,598 324,595 308,595 309,593 293,593 295,590 279,590 281,587 265,587 267,584 250,584 251,582 235,582 237,579 221,579 223,576 207,576 209,573 193,573 196,568 179,568 183,561 166,561 170,554 153,554 157,547)
    - (positive, 192,462 197,462 188,446 195,446 186,431 193,431 184,415 192,415 183,400 191,400 182,385 190,385 181,370 189,370 180,355 189,355 180,340 189,340 180,325 189,325 180,310 189,310 180,295 191,295 182,280 192,280 184,266 195,266 186,251 198,251 189,236 200,236 192,222 203,222 195,208 206,208 198,194 210,194 203,181 217,181 211,170 226,170 222,163 239,163 236,158 253,158 251,154 267,154 265,151 281,151 280,149 297,149 296,147 333,147 332,148 348,148 347,149 363,149 362,150 378,150 377,151 393,151 392,152 439,152 438,153 470,153 469,154 485,154 484,155 621,155 620,156 636,156 635,157 666,157 665,158 696,158 695,160 711,160 710,161 726,161 725,163 741,163 740,164 756,164 754,167 771,167 766,175 777,175 769,189 779,189 770,204 779,204 770,219 779,219 770,234 779,234 770,249 779,249 770,264 779,264 770,279 779,279 770,294 775,294 767,308 774,308 765,323 773,323 763,341 783,341 757,386 769,386 755,411 769,411 755,435 764,435 753,454 764,454 751,477 756,477 747,493 753,493 743,510 745,510 743,514 738,506 730,521 724,511 714,528 707,515 694,537 683,518 670,540 659,520 649,538 640,523 630,541 620,524 610,541 601,525 592,541 583,525 573,543 563,526 551,547 539,526 527,547 515,526 502,548 490,526 477,548 465,526 455,543 445,526 434,544 424,526 411,549 398,526 389,541 380,525 373,537 365,523 359,534 351,520 344,532 336,518 330,529 322,515 316,526 308,512 301,524 293,509 286,521 278,507 272,518 264,504 258,515 250,501 244,512 236,498 230,508 222,493 218,501 209,486 207,489)
      - (negative, 270,468 275,459 261,459 269,445 256,445 264,431 251,431 259,417 247,417 255,403 244,403 252,389 240,389 248,375 236,375 244,361 233,361 241,347 229,347 237,333 225,333 234,318 225,318 233,304 229,304 272,229 273,230 280,217 282,220 290,206 294,212 302,198 307,206 315,192 321,202 329,188 335,198 343,183 349,194 357,180 363,191 371,177 377,188 385,174 391,185 399,171 406,183 414,169 422,182 429,169 437,182 444,169 452,182 459,169 467,182 474,169 482,182 489,169 497,182 504,169 512,182 519,169 527,182 534,169 542,182 549,169 557,182 564,169 572,182 579,169 587,182 594,169 602,182 609,169 617,182 624,169 632,184 639,172 647,186 654,174 662,188 668,178 676,192 682,182 689,195 690,194 733,269 731,269 739,283 736,283 744,297 740,297 748,311 741,311 750,326 740,326 749,341 738,341 746,355 735,355 744,370 733,370 741,384 729,384 737,398 725,398 733,412 720,412 727,425 713,425 721,439 708,439 715,452 701,452 708,465 692,465 698,476 682,476 687,485 669,485 674,493 656,493 661,501 645,501 648,507 632,507 635,513 617,513 620,518 604,518 606,521 590,521 591,522 460,522 461,520 444,520 446,517 428,517 429,515 412,515 414,511 397,511 400,506 383,506 385,502 368,502 371,496 354,496 357,490 340,490 343,485 326,485 329,480 312,480 315,475 298,475 300,471 284,471 286,468)
        - (positive, 327,396 326,397 322,389 326,389 318,375 322,375 314,361 319,361 311,347 315,347 307,333 311,333 302,318 311,318 303,304 315,304 308,292 323,292 317,281 333,281 328,273 345,273 342,267 358,267 356,263 372,263 369,258 386,258 384,255 400,255 398,252 414,252 412,249 428,249 426,246 442,246 441,244 598,244 596,247 612,247 611,249 627,249 625,253 641,253 639,257 654,257 647,269 661,269 653,283 666,283 658,297 670,297 662,311 673,311 664,326 672,326 663,341 668,341 660,355 667,355 658,370 663,370 655,384 659,384 651,398 655,398 647,412 648,412 647,415 644,410 635,425 631,418 622,433 618,426 610,440 605,432 597,446 592,438 583,454 577,443 569,457 563,446 555,460 548,447 541,460 533,447 525,460 518,447 510,460 503,447 496,460 487,445 480,457 471,442 464,455 455,440 449,451 440,436 434,446 426,431 420,442 411,427 406,436 397,421 392,430 383,415 377,425 369,410 363,420 355,405 349,415 341,400 335,411)
          - (negative, 372,385 379,372 333,372 376,297 377,299 385,286 388,291 396,276 402,286 410,272 416,283 424,269 431,282 439,268 447,281 454,268 462,281 469,268 477,281 484,268 492,281 499,268 506,280 514,266 522,279 529,266 536,279 544,265 552,278 559,265 567,279 573,268 581,282 584,277 627,352 618,352 627,367 614,367 622,381 608,381 616,395 601,395 607,406 590,406 595,414 579,414 580,415 389,415 391,412 375,412 382,399 369,399 377,385)
            - (positive, 497,296 523,342 548,299 591,374 505,374 507,371 399,371 442,296 469,344)
''');

  final polygon = Polygon(points: parse('502,236 545,311 459,311'));

  final pstate = PolygonState.assignParents(state);
  final merger = PolygonMerger(
    onAdd: (p, parent) {
      print('add $p to $parent');
      if (!p.isSimple()) {
        print('POLYGON IS NOT SIMPLE');
      }
    },
    onRemove: (p) => print('remove $p'),
    onUpdateParent: (p, parent) => print('reappend $p to $parent'),
  );
  merger.mergePolygon(pstate, polygon);
  print(pstate);
  print(pstate.isValid());
}
