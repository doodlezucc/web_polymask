import 'package:web_polymask/math/polygon.dart';
import 'package:web_polymask/math/polygon_state.dart';
import 'package:web_polymask/math/polymath.dart';

import 'test_helpers.dart';

void main() {
  final state = parseState('''
- (positive, 226,269 240,245 235,245 243,231 240,231 248,217 245,217 252,204 251,204 294,129 295,130 302,117 304,121 313,106 317,114 326,99 331,107 339,93 345,103 353,88 359,98 367,83 373,93 381,79 388,91 396,77 404,90 412,76 420,90 427,78 435,92 438,87 447,103 450,98 458,113 461,108 469,122 472,117 480,131 485,123 493,138 499,128 507,142 511,136 520,151 524,143 532,157 536,151 545,166 549,158 558,173 562,166 570,180 574,174 583,190 588,182 597,197 600,191 608,205 611,200 619,215 622,210 630,223 631,221 639,234 640,232 683,307 682,307 689,320 685,320 693,334 685,334 694,349 685,349 694,364 685,364 694,379 683,379 691,393 679,393 687,407 673,407 680,420 666,420 673,433 658,433 665,446 649,446 656,458 641,458 647,469 630,469 636,480 619,480 624,488 606,488 610,495 592,495 597,503 581,503 584,509 566,509 569,514 553,514 555,518 538,518 541,523 523,523 526,529 509,529 512,534 496,534 499,540 483,540 486,546 469,546 472,551 456,551 458,555 442,555 443,557 342,557 344,553 327,553 332,545 304,545 308,538 280,538 284,531 262,531 266,524 249,524 254,515 238,515 246,501 233,501 241,487 230,487 241,468 228,468 238,450 227,450 237,433 226,433 235,418 224,418 233,403 221,403 230,388 220,388 229,373 222,373 229,360 228,360 235,347 234,347 242,334 241,334 264,294 259,294 261,290 236,290 245,275 234,275 238,269)
  - (negative, 397,158 393,158 395,162)
  - (negative, 404,489 400,482 393,495 385,482 379,493 370,478 361,494 347,470 337,487 323,463 316,475 312,468 314,468 304,450 313,450 303,433 312,433 303,418 310,418 301,403 307,403 298,388 306,388 297,373 308,373 301,360 314,360 307,347 320,347 312,334 327,334 320,321 335,321 327,308 342,308 334,294 345,294 337,280 339,280 319,245 321,245 313,231 326,231 318,217 331,217 324,204 337,204 330,192 345,192 339,181 356,181 352,174 369,174 366,168 382,168 379,163 396,163 395,162 413,162 407,173 424,173 418,183 434,183 429,192 445,192 442,198 459,198 456,203 473,203 468,211 485,211 481,218 496,218 480,247 473,235 470,240 462,226 456,236 448,222 441,235 433,222 425,236 418,223 375,298 387,298 359,347 373,347 365,360 376,360 368,374 381,374 373,388 461,388 422,456 423,456)
  - (negative, 536,504 450,504 493,429 495,432 502,420 500,420 508,406 503,406 511,392 508,392 515,379 472,379 477,370 461,370 463,367 389,367 396,354 382,354 391,339 384,339 427,264 428,266 436,253 443,266 451,252 459,265 466,252 474,266 481,254 489,268 494,260 498,267 528,214 530,217 538,203 539,204 546,191 554,204 561,191 569,204 576,191 584,205 589,197 597,211 598,209 606,223 607,221 650,296 645,296 653,310 644,310 653,325 644,325 653,340 644,340 653,355 643,355 652,370 643,370 652,385 643,385 652,400 641,400 649,414 637,414 645,428 629,428 634,437 618,437 620,440 577,440 583,450 570,450 578,464 561,464 567,474 550,474 555,482 540,482 546,493 530,493)
    - (positive, 505,421 505,420 504,420)
    - (positive, 489,371 500,352 499,352 501,348 470,348 471,346 455,346 498,271 502,278 543,206 554,226 521,284 522,284 497,328 510,328 502,342 506,342 532,296 540,310 547,297 552,305 560,290 560,291 575,265 595,299 601,288 599,284 607,284 576,230 578,226 586,240 588,237 631,312 623,312 632,327 626,327 645,361 616,361 621,370 605,370 606,372 504,372 505,371)
      - (negative, 504,281 508,281 506,285)
''');

  final polygon =
      Polygon(points: parse('517,295 560,370 474,370'), positive: false);

  final pstate = PolygonState.assignParents(state);
  final merger = PolygonMerger(
    onAdd: (p, parent) {
      print('add $p to $parent');
      if (!p.isSimple()) {
        print('POLYGON IS NOT SIMPLE');
      }
    },
    onRemove: (p) => print('remove $p'),
    onUpdateParent: (p, parent) => print('reappend $p to $parent'),
  );
  merger.mergePolygon(pstate, polygon);
  print(pstate);
  print(pstate.isValid());
}
