import 'package:web_polymask/math/polygon.dart';
import 'package:web_polymask/math/polygon_state.dart';
import 'package:web_polymask/math/polymath.dart';

import 'test_helpers.dart';

void main() {
  final state = parseState('''
- (positive, 169,228 176,216 177,214 131,214 174,139 177,144 185,130 189,136 197,122 201,128 209,114 214,122 222,108 227,117 236,102 242,112 250,97 256,107 264,93 270,103 278,89 284,100 292,86 299,98 308,83 315,95 324,80 331,93 340,78 347,91 355,77 363,90 371,76 379,90 387,76 395,89 402,76 410,89 417,76 425,90 432,77 440,91 446,80 454,94 460,83 468,97 474,87 482,102 488,92 496,107 502,97 510,111 515,103 523,117 528,109 536,123 541,115 550,130 554,122 563,137 567,130 576,146 580,139 588,153 592,147 600,161 603,156 611,171 614,166 622,180 624,177 632,191 634,188 642,201 643,199 651,213 652,211 660,224 661,222 668,235 669,234 712,309 711,309 718,322 714,322 722,336 714,336 723,351 714,351 723,366 711,366 719,380 705,380 713,394 698,394 705,407 690,407 697,419 680,419 687,431 670,431 677,443 661,443 667,454 651,454 657,465 641,465 646,474 628,474 634,484 617,484 622,492 605,492 609,499 591,499 596,507 580,507 583,513 566,513 569,518 552,518 555,523 539,523 541,526 524,526 525,528 391,528 393,525 374,525 376,522 360,522 363,517 345,517 348,511 327,511 331,504 311,504 316,496 293,496 298,487 275,487 280,479 262,479 268,468 247,468 254,456 234,456 240,446 223,446 230,434 214,434 220,423 205,423 212,410 196,410 203,397 189,397 196,384 183,384 191,370 178,370 186,356 175,356 183,342 170,342 178,328 167,328 175,314 164,314 172,300 160,300 169,285 158,285 167,270 158,270 167,255 158,255 166,241 162,241)
  - (negative, 391,153 391,152 392,152)
  - (negative, 373,308 459,308 450,293 457,293 448,278 455,278 446,263 453,263 444,248 451,248 444,235 445,235 402,160 401,161 396,152 405,152 403,155 419,155 417,158 433,158 431,162 448,162 445,167 462,167 459,172 475,172 472,178 488,178 485,184 501,184 498,190 515,190 511,197 529,197 524,205 542,205 537,214 554,214 549,222 565,222 560,231 577,231 571,241 587,241 581,252 597,252 591,263 606,263 600,274 616,274 609,286 624,286 618,297 633,297 626,309 639,309 632,322 644,322 636,336 646,336 637,351 646,351 637,366 638,366 635,371 634,368 626,382 624,379 616,393 614,390 606,404 603,399 594,414 591,409 583,423 579,417 570,432 566,424 557,439 553,432 545,446 540,438 532,453 526,443 518,458 512,448 504,462 498,451 489,466 482,453 474,467 466,453 458,467 450,453 442,467 434,453 426,466 417,450 411,461 403,447 397,458 388,442 381,455 370,436 364,446 354,429 347,441 336,421 330,432 318,412 314,419 305,404 301,412 290,393 287,398 277,381 274,386 266,371 265,373 263,370 264,370 256,356 261,356 253,342 256,342 248,328 253,328 245,314 250,314 242,300 246,300 237,285 244,285 235,270 244,270 235,255 244,255 236,241 248,241 240,228 255,228 249,217 264,217 258,207 275,207 270,199 287,199 283,192 302,192 300,195 317,195 314,200 331,200 328,205 345,205 340,213 357,213 351,223 366,223 359,235 372,235 365,248 376,248 367,263 378,263 369,278 380,278 371,293 382,293)
    - (positive, 315,405 358,330 366,344 372,333 380,347 387,334 394,347 402,334 409,347 417,334 424,347 432,334 439,347 447,334 454,347 462,334 470,347 477,334 483,345 491,331 497,341 505,326 508,332 517,317 517,318 539,280 582,355 569,355 576,368 562,368 569,381 554,381 560,392 543,392 548,401 531,401 534,406 518,406 520,409 344,409 345,408 329,408 331,405)
    - (positive, 314,227 357,302 271,302)
''');

  final polygon = Polygon(points: parse('366,265 409,340 323,340'));

  final pstate = PolygonState.assignParents(state);
  final merger = PolygonMerger(
    onAdd: (p, parent) {
      print('add $p to $parent');
      if (!p.isSimple()) {
        print('POLYGON IS NOT SIMPLE');
      }
    },
    onRemove: (p) => print('remove $p'),
    onUpdateParent: (p, parent) => print('reappend $p to $parent'),
  );
  merger.mergePolygon(pstate, polygon);
  print(pstate);
  print(pstate.isValid());
}
