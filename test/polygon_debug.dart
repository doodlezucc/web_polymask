import 'package:web_polymask/math/polygon.dart';
import 'package:web_polymask/math/polygon_state.dart';
import 'package:web_polymask/math/polymath.dart';

import 'test_helpers.dart';

void main() {
  final state = parseState('''
- (positive, 536,40 577,40 575,43 562,59 544,84 545,85 546,84 559,75 571,66 587,56 605,48 619,41 622,40 775,40 785,44 793,49 802,53 813,59 825,68 829,72 841,81 849,90 856,98 864,107 871,116 877,126 884,136 892,150 898,162 902,173 908,191 910,206 911,221 911,233 909,249 906,263 901,277 898,284 886,308 881,314 875,323 869,330 854,348 846,355 840,361 826,373 818,380 809,387 799,395 792,400 782,407 770,414 758,422 750,426 737,433 695,451 659,463 648,467 637,470 626,472 615,475 603,477 591,480 582,481 572,483 561,484 513,484 503,483 494,483 483,482 476,480 467,479 449,475 441,472 434,470 418,464 397,455 391,451 382,446 368,438 362,434 354,429 342,419 336,415 330,410 324,404 317,398 311,392 306,386 296,376 289,377 282,379 274,380 264,382 254,383 245,385 228,387 216,389 202,390 194,392 185,393 176,395 165,396 149,398 140,399 132,401 123,401 115,403 107,403 100,405 92,406 85,408 69,410 60,411 40,411 40,339 44,338 52,338 61,337 69,336 99,330 105,330 115,328 122,328 132,326 141,325 157,323 166,322 182,319 194,317 208,316 220,314 237,312 243,311 242,309 237,295 239,280 247,266 259,257 274,254 289,257 301,266 306,274 312,281 317,287 321,293 323,295 331,293 338,290 346,286 352,282 359,275 366,267 374,258 384,246 393,235 406,221 416,208 427,195 427,179 426,158 424,142 424,141 421,135 419,129 418,127 414,121 407,114 401,110 396,107 393,106 384,104 376,102 348,102 332,104 323,105 316,107 313,108 294,119 292,121 288,126 284,130 282,133 278,141 278,142 277,150 277,159 281,173 282,180 279,186 275,191 268,194 262,194 255,191 251,186 248,180 244,166 243,158 243,150 244,143 245,135 248,128 252,120 260,108 266,102 272,95 277,91 298,79 306,76 320,72 329,71 345,69 379,69 386,71 387,71 394,73 396,73 403,75 411,78 418,82 424,86 429,90 435,96 440,102 448,114 452,121 454,128 457,135 458,142 458,143 459,150 459,151 463,145 482,116 510,77)
  - (negative, 383,350 395,342 401,337 408,330 414,322 415,322 419,317 422,313 423,313 443,289 444,288 455,276 465,264 475,251 477,249 487,238 499,225 522,202 533,192 545,180 556,170 570,159 583,148 596,139 608,130 624,120 628,118 642,112 647,109 655,107 667,103 677,102 718,102 734,105 750,109 756,113 765,117 776,123 783,130 792,136 797,141 805,150 812,159 817,168 825,179 831,191 835,202 836,205 836,206 837,221 837,234 834,248 831,255 825,267 822,271 816,280 810,287 805,293 797,300 791,306 777,318 769,325 760,332 755,336 745,343 733,350 721,358 713,362 700,369 672,381 636,393 625,397 617,399 603,402 597,404 595,404 580,407 578,408 574,408 564,410 553,411 521,411 511,410 502,410 472,405 464,402 457,400 441,394 434,391 428,387 419,382 405,374 396,368 391,364 379,355 377,353)
''');

  final polygon = Polygon(points: parse('577,40 575,43 571,40'));

  final pstate = PolygonState.assignParents(state);
  print(pstate.isValid(checkSimplicity: true));
  final merger = PolygonMerger(
    onAdd: (p, parent) {
      print('add $p to $parent');
      if (!p.isSimple()) {
        print('POLYGON IS NOT SIMPLE');
      }
    },
    onRemove: (p) => print('remove $p'),
    onUpdateParent: (p, parent) => print('reappend $p to $parent'),
  );
  merger.mergePolygon(pstate, polygon);
  print(pstate);
  print(pstate.isValid(checkSimplicity: true));
}
